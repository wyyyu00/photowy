<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æˆ‘çš„æ‘„å½±é›† | ç‹å®‡ Photo</title>
  <!-- è®©é¡µé¢åœ¨æ‰‹æœºä¸Šä¹Ÿå¥½çœ‹ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- è¿æ¥å¤–éƒ¨æ ·å¼è¡¨ -->
  <link rel="stylesheet" href="styles.css" />
</head>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<script>
  // 1. åˆå§‹åŒ– Supabase å®¢æˆ·ç«¯
  const { createClient } = supabase;

  // TODO: ç”¨ä½ è‡ªå·±çš„é¡¹ç›® URL å’Œ anon key æ›¿æ¢ä¸‹é¢ä¸¤è¡Œ
  const SUPABASE_URL = 'https://tktotrnetddatrzzybnq.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRrdG90cm5ldGRkYXRyenp5Ym5xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNTMyNDcsImV4cCI6MjA3OTgyOTI0N30.-BM_5r2qZVTsTq3uNqbWDitNTBTSxXPwIY6lzCz74aI';
  const BUCKET = 'photowy';


  const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  document.addEventListener("DOMContentLoaded", () => {

    const uploadForm = document.getElementById("upload-form");
    const photosInput = document.getElementById("photos-input");
    const statusSpan = document.getElementById("upload-status");
    const gallery = document.querySelector(".gallery");

    // é¡µé¢åŠ è½½æ—¶è¯»å–å·²æœ‰å›¾ç‰‡
    loadExistingPhotos();

    // ç»‘å®šä¸Šä¼ äº‹ä»¶
    if (uploadForm && photosInput && statusSpan) {
      uploadForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const files = photosInput.files;
        if (!files || files.length === 0) {
          alert("è¯·å…ˆé€‰æ‹©è¦ä¸Šä¼ çš„ç…§ç‰‡");
          return;
        }

        statusSpan.textContent = "æ­£åœ¨ä¸Šä¼ ...";

        try {
          const uploadedItems = [];

          for (let i = 0; i < files.length; i++) {
            const file = files[i];

            const dot = file.name.lastIndexOf(".");
            const ext = dot !== -1 ? file.name.slice(dot) : "";
            const safeName = `photo-${Date.now()}-${i}${ext}`;
            const safeFile = new File([file], safeName, { type: file.type });

            const path = `albums/${safeName}`;

            const { data, error } = await client.storage
              .from(BUCKET)
              .upload(path, safeFile, {
                cacheControl: "3600",
                upsert: false,
              });

            if (error) {
              console.error("ä¸Šä¼ å¤±è´¥ï¼š", error);
              throw error;
            }

            const { data: pub } = client.storage
              .from(BUCKET)
              .getPublicUrl(path);

            const url = pub.publicUrl;

            uploadedItems.push({
              originalName: file.name,
              safeName,
              url,
            });
          }

          statusSpan.textContent = `ä¸Šä¼ æˆåŠŸï¼Œå…± ${uploadedItems.length} å¼ `;

          if (gallery) {
            uploadedItems.forEach((item) => {
              const card = createPhotoCard({
                title: item.originalName,
                url: item.url,
              });
              gallery.prepend(card);
            });
          }
        } catch (err) {
          console.error("ä¸Šä¼ å‡ºé”™ï¼š", err);
          statusSpan.textContent = "ä¸Šä¼ å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°";
        }
      });
    }

    // åŠ è½½å·²æœ‰å›¾ç‰‡
    async function loadExistingPhotos() {
      if (!gallery) return;

      try {
        const { data, error } = await client.storage
          .from(BUCKET)
          .list("albums", {
            limit: 1000,
            sortBy: { column: "created_at", order: "desc" },
          });

        if (error) {
          console.error("åŠ è½½å¤±è´¥ï¼š", error);
          return;
        }

        (data || []).forEach((item) => {
          const path = `albums/${item.name}`;
          const { data: pub } = client.storage
            .from(BUCKET)
            .getPublicUrl(path);

          const url = pub.publicUrl;

          const card = createPhotoCard({
            title: item.name,
            url: url,
          });

          gallery.appendChild(card);
        });
      } catch (err) {
        console.error("è¯»å–å›¾ç‰‡æ—¶å‡ºé”™ï¼š", err);
      }
    }

    // åˆ›å»ºç…§ç‰‡å¡ç‰‡
    function createPhotoCard({ title, url }) {
      const card = document.createElement("article");
      card.className = "album-card";
      card.innerHTML = `
        <div class="album-image" style="background-image: url('${url}')"></div>
        <div class="album-info">
          <h2 class="album-title">${title}</h2>
          <p class="album-meta">1 å¼ ç…§ç‰‡</p>
          <div class="album-footer">
            <div class="album-author">
              <div class="avatar tiny"></div>
              <span>ç‹å®‡</span>
            </div>
            <div class="album-actions">
              <a class="icon download original"
                 href="${url}?download=${encodeURIComponent(title)}"
                 target="_blank">
                â¬‡ åŸå›¾
              </a>
            </div>
          </div>
        </div>
      `;
      return card;
    }

  });
</script>






<body>
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <header class="navbar">
    <div class="navbar-left">
      <div class="logo-circle"></div>
      <span class="logo-text">ç‹å®‡ Photo</span>
    </div>

    <nav class="navbar-center">
      <a href="#" class="nav-link active">å‘ç°</a>
      <a href="#" class="nav-link">æ‘„å½±é›†</a>
      <a href="#" class="nav-link">æ‘„å½±å¸ˆ</a>
      <div class="search-box">
        <input type="text" placeholder="æœç´¢ä½œå“ / æ ‡ç­¾ / åœ°ç‚¹..." />
      </div>
    </nav>

    <div class="navbar-right">
      <button class="btn btn-outline">ç™»å½•</button>
      <button class="btn btn-primary">ä¸Šä¼ ä½œå“</button>
      <div class="avatar"></div>
    </div>
  </header>

  <!-- é¡¶éƒ¨å¤§å›¾åŒºåŸŸï¼ˆHeroï¼‰ -->
  <section class="hero">
    <div class="hero-image"></div>
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <p class="hero-tag">ç²¾é€‰æ‘„å½±é›†</p>
      <h1 class="hero-title">åŸå¸‚å¤œè‰² Â· å°¤å…¶å®‰é™çš„å…‰</h1>
      <p class="hero-desc">
        ä¸€ç»„è®°å½•å¤œè‰²ä¸éœ“è™¹çš„ä½œå“ã€‚å…‰çº¿ã€é›¨æ»´å’Œè¡Œäººçš„å‰ªå½±ï¼Œæ„æˆäº†æˆ‘çœ¼é‡Œçš„åŸå¸‚ç‰‡åˆ»ã€‚
      </p>
      <div class="hero-meta">
        <div class="hero-author">
          <div class="avatar small"></div>
          <span>by ç‹å®‡</span>
        </div>
        <button class="btn btn-primary">æŸ¥çœ‹æ‘„å½±é›†</button>
      </div>
    </div>
  </section>

  <!-- ç­›é€‰å·¥å…·æ  -->
  <section class="filters">
    <div class="filters-left">
      <span class="filters-label">åˆ†ç±»ï¼š</span>
      <button class="chip chip-active">å…¨éƒ¨</button>
      <button class="chip">é£å…‰</button>
      <button class="chip">äººåƒ</button>
      <button class="chip">è¡—æ‹</button>
      <button class="chip">çºªå®</button>
      <button class="chip">å»ºç­‘</button>
    </div>
    <div class="filters-right">
      <select class="select">
        <option>æ’åºï¼šæœ€æ–°</option>
        <option>æ’åºï¼šæœ€çƒ­</option>
        <option>æ’åºï¼šä¸‹è½½æœ€å¤š</option>
      </select>
      <label class="checkbox-label">
        <input type="checkbox" />
        <span>ä»…æ˜¾ç¤ºå¯ä¸‹è½½åŸå›¾</span>
      </label>
    </div>
  </section>

  <!-- ä¸Šä¼ åŒºåŸŸï¼šç®€å•ç¤ºä¾‹ -->
<section class="upload-panel">
  <h2 class="upload-title">ä¸Šä¼ æ–°çš„æ‘„å½±é›†</h2>
  <form id="upload-form">
    <label class="upload-label">
      é€‰æ‹©ç…§ç‰‡ï¼ˆå¯å¤šé€‰ï¼‰ï¼š
      <input id="photos-input" type="file" name="photos" multiple accept="image/*" />
    </label>
    <button type="submit" class="btn btn-primary">å¼€å§‹ä¸Šä¼ </button>
    <span id="upload-status" class="upload-status"></span>
  </form>
</section>


  <!-- æ‘„å½±é›†ç€‘å¸ƒæµåŒºåŸŸ -->
  <main class="gallery">
    <!-- æ‘„å½±é›†å¡ç‰‡ç¤ºä¾‹ 1 -->
    <article class="album-card">
      <div class="album-image"></div>
      <div class="album-info">
        <h2 class="album-title">æ£®æ—é‡Œçš„å®‰é™å…‰çº¿</h2>
        <p class="album-meta">24 å¼ ç…§ç‰‡ Â· é£å…‰ / è‡ªç„¶</p>
        <div class="album-footer">
          <div class="album-author">
            <div class="avatar tiny"></div>
            <span>ç‹å®‡</span>
          </div>
          <div class="album-actions">
            <span class="icon">â¤ 128</span>
            <span class="icon">ğŸ‘ 1.2k</span>
            <span class="icon download allowed" title="å¯ä¸‹è½½ä¸­ç­‰åˆ†è¾¨ç‡">
              â¬‡
            </span>
          </div>
        </div>
      </div>
    </article>

    <!-- æ‘„å½±é›†å¡ç‰‡ç¤ºä¾‹ 2 -->
    <article class="album-card tall">
      <div class="album-image"></div>
      <div class="album-info">
        <h2 class="album-title">é›¨ä¸­çš„è¡—è§’</h2>
        <p class="album-meta">16 å¼ ç…§ç‰‡ Â· è¡—æ‹ / å¤œæ™¯</p>
        <div class="album-footer">
          <div class="album-author">
            <div class="avatar tiny"></div>
            <span>ç‹å®‡</span>
          </div>
          <div class="album-actions">
            <span class="icon">â¤ 256</span>
            <span class="icon">ğŸ‘ 2.3k</span>
            <span class="icon download locked" title="ä½œè€…å·²å…³é—­ä¸‹è½½">
              ğŸ”’
            </span>
          </div>
        </div>
      </div>
    </article>

    <!-- æ‘„å½±é›†å¡ç‰‡ç¤ºä¾‹ 3 -->
    <article class="album-card wide">
      <div class="album-image"></div>
      <div class="album-info">
        <h2 class="album-title">äººåƒ Â· æŸ”å’Œè‡ªç„¶å…‰</h2>
        <p class="album-meta">32 å¼ ç…§ç‰‡ Â· äººåƒ / æ—¥ç³»</p>
        <div class="album-footer">
          <div class="album-author">
            <div class="avatar tiny"></div>
            <span>ç‹å®‡</span>
          </div>
          <div class="album-actions">
            <span class="icon">â¤ 512</span>
            <span class="icon">ğŸ‘ 3.7k</span>
            <span class="icon download original" title="å¯ä¸‹è½½åŸå›¾">
              â¬‡ 4K
            </span>
          </div>
        </div>
      </div>
    </article>

    <!-- ä½ å¯ä»¥å¤åˆ¶æ›´å¤š album-card æ¥æ¨¡æ‹Ÿæ›´å¤šæ‘„å½±é›† -->
  </main>

  <!-- é¡µè„š -->
  <footer class="footer">
    <p>Â© 2025 ç‹å®‡ Photo. ç‰ˆæƒæ‰€æœ‰.</p>
    <p>è¿™åªæ˜¯å‰ç«¯ç•Œé¢ç¤ºæ„ï¼Œå®é™…ä¸Šä¼ /ä¸‹è½½åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒã€‚</p>
  </footer>
</body>
</html>
